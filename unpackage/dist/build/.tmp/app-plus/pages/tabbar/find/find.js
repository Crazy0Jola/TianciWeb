(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/tabbar/find/find"],{"021a":function(e,t,n){},"3a4c":function(e,t,n){"use strict";(function(e){n("68ca"),n("921b");o(n("66fd"));var t=o(n("f5cc"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("6e42")["createPage"])},"4cd5":function(e,t,n){"use strict";(function(e,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n("8f4b"));function i(e){return e&&e.__esModule?e:{default:e}}var a,r=function(){return n.e("components/im-chat/chatinput").then(n.bind(null,"6795"))},c=function(){return n.e("components/free-ui/free-confirm").then(n.bind(null,"ebf9"))},u=function(){return n.e("components/free-ui/free-popup").then(n.bind(null,"29d6"))},d=getApp().globalData.SERVER_API,p={components:{chatInput:r,freeConfirm:c,freePopup:u},data:function(){return{propIndex:-1,posts:[],username:"Liuxy",myAvatar:"",myToken:"",myId:"",comment_id:"",user_id:"",comment_index:"",comment_content:"",menus:[{name:"复制",event:"copy"},{name:"删除",event:"delete"}],index:"",input_placeholder:"评论",focus:!1,is_reply:!1,showInput:!1,parentName:"",parentId:"",screenHeight:"",platform:"",windowHeight:"",loadMoreText:"加载中...",showLoadMore:!0,pageNo:1}},mounted:function(){e.getStorage({key:"posts",success:function(e){console.log(o(e.data," at pages\\tabbar\\find\\find.vue:140")),this.posts=e.data}})},onLoad:function(){var t=this;a=this;var n=e.getStorageSync("setUserData");console.log(o(n," at pages\\tabbar\\find\\find.vue:149")),a.myAvatar=n.photo,a.username=n.name,a.myToken=n.token,a.myId=n.id,e.getSystemInfo({success:function(e){t.screenHeight=e.screenHeight,t.platform=e.platform}}),e.startPullDownRefresh()},onShow:function(){var t=this;e.onWindowResize(function(e){"ios"===t.platform?(t.windowHeight=e.size.windowHeight,t.adjust()):t.screenHeight-e.size.windowHeight>60&&t.windowHeight<=e.size.windowHeight&&(t.windowHeight=e.size.windowHeight,t.adjust())})},onHide:function(){e.offWindowResize()},onUnload:function(){this.data=[]},onReachBottom:function(){console.log(o("onReachBottom"," at pages\\tabbar\\find\\find.vue:184")),console.log(o(a.pageNo," at pages\\tabbar\\find\\find.vue:185")),a.showLoadMore&&e.request({url:d+"appFriends/list",data:{type:"2",pageNo:a.pageNo.toString()},method:"POST",header:{token:a.myToken},success:function(e){if(console.log(o(e," at pages\\tabbar\\find\\find.vue:198")),1==e.data.code){e.data.result.length<10&&(a.loadMoreText="暂无更多",a.showLoadMore=!1);for(var t=a.posts.length,n=e.data.result,s=n.length,i=0;i<t;i++)for(var r=0;r<s;r++)if(a.posts[i].id==n[r].id){n=n.splice(r,1);break}a.posts=a.posts.concat(n),console.log(o(JSON.stringify(a.posts)," at pages\\tabbar\\find\\find.vue:216")),a.pageNo++;var c=a.posts.length;console.log(o(c," at pages\\tabbar\\find\\find.vue:220"));for(i=10*a.pageNo;i<c;i++)a.posts[i].like=a.islike(i)}},fail:function(t){console.log(o(t," at pages\\tabbar\\find\\find.vue:228")),e.showToast({title:t.data.message,position:"bottom"})}})},onPullDownRefresh:function(){console.log(o("onPullDownRefresh"," at pages\\tabbar\\find\\find.vue:238")),this.loadMoreText="加载中...",this.showLoadMore=!0,this.pageNo=1,e.request({url:d+"appFriends/list",data:{type:"1",pageNo:"0"},method:"POST",header:{token:a.myToken},success:function(t){a.posts=t.data.result;var n=a.posts.length;n<10&&(a.loadMoreText="暂无更多",a.showLoadMore=!1);for(var o=0;o<n;o++)a.posts[o].like=a.islike(o);e.stopPullDownRefresh()},fail:function(t){console.log(o(t," at pages\\tabbar\\find\\find.vue:265")),e.showToast({title:t.data.message,position:"bottom"}),e.stopPullDownRefresh()}})},onNavigationBarButtonTap:function(t){0==t.index&&e.navigateTo({url:"../publish/publish"})},computed:{getMenusHeight:function(){var e=100;return this.menus.length*e},getMenusStyle:function(){return"height: ".concat(this.getMenusHeight,"rpx;")},islike:function(){return function(e){for(var t=a.posts[e].praiseUserList,n=t.length,o=0;o<n;o++)if(a.myId===t[o].id)return!0;return!1}},isMine:function(){return function(e){return e==a.myId}},getCreateTime:function(){return function(e){return s.default.getTimeFormat(a.posts[e].createTime.substring(0,19))}}},methods:{clickEvent:function(t){switch(t){case"copy":e.setClipboardData({data:a.comment_content,success:function(){console.log(o("success"," at pages\\tabbar\\find\\find.vue:324"))}});break;case"delete":this.deleteComment();break}this.$refs.extend.hide()},deleteComment:function(){e.request({url:d+"appFriends/deleteComment",method:"POST",data:{commentId:a.comment_id},header:{token:a.myToken},success:function(e){console.log(o(e," at pages\\tabbar\\find\\find.vue:345")),1==e.data.code&&a.posts[a.index].commentList.splice(a.comment_index,1)},fail:function(t){e.showToast({title:t.data.message,position:"bottom"})}})},long:function(e){console.log(o(e," at pages\\tabbar\\find\\find.vue:359"));var t=0,n=0;Array.isArray(e.changedTouches)&&e.changedTouches.length>0&&(t=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY),a.comment_id=e.currentTarget.id,a.user_id=e.currentTarget.dataset.userid,a.index=e.currentTarget.dataset.postindex,a.comment_index=e.currentTarget.dataset.commentindex,a.comment_content=e.currentTarget.dataset.commentcontent,a.myId!=a.user_id&&a.menus.splice(1,1),this.$refs.extend.show(t,n)},deletePost:function(t,n){this.$refs.confirm.show(function(o){e.request({url:d+"appFriends/delete",data:{postId:t},method:"POST",header:{token:a.myToken},success:function(t){1==t.data.code&&(e.showToast({title:"删除成功"}),a.posts.splice(n,1))},fail:function(t){e.showToast({title:t.data.message,position:"bottom"})}}),o()})},changeLike:function(t,n){a.posts[n].like?e.request({url:d+"appFriends/canclePraise",method:"POST",header:{token:a.myToken},data:{postId:t},success:function(e){1==e.data.code&&(a.posts[n].like=!1,a.posts[n].praiseUserList.splice(a.posts[n].praiseUserList.indexOf({id:a.myId}),1))},fail:function(t){e.showToast({title:t.data.message,position:"bottom"})}}):e.request({url:d+"appFriends/praise",method:"POST",header:{token:a.myToken},data:{postId:t},success:function(e){1==e.data.code&&(a.posts[n].like=!0,a.posts[n].praiseUserList.push({id:a.myId,postId:t,userRealName:a.username}))},fail:function(t){e.showToast({title:t.data.message,position:"bottom"})}})},comment:function(e){this.showInput=!0,this.focus=!0,this.index=e},adjust:function(){},reply:function(e,t,n){this.is_reply=!0,this.showInput=!0,this.parentName=a.posts[t].commentList[n].commentUserName,this.input_placeholder="回复"+this.parentName,this.index=t,this.parentId=e,this.focus=!0},blur:function(){this.init_input()},send_comment:function(t){a.is_reply?e.request({url:d+"appFriends/publishComment",method:"POST",header:{token:a.myToken},data:{postId:a.posts[a.index].id,content:t.content,parentId:a.parentId,parentName:a.parentName},success:function(e){console.log(o(e," at pages\\tabbar\\find\\find.vue:515")),1==e.data.code&&(a.posts[a.index].commentList.push({postId:a.posts[a.index].id,content:t.content,commentUserId:a.myId,commentUserName:a.username,parentId:a.parentId,parentName:a.parentName}),a.init_input())},fail:function(t){e.showToast({title:t.data.message,position:"bottom"})}}):e.request({url:d+"appFriends/publishComment",method:"POST",header:{token:a.myToken},data:{postId:a.posts[a.index].id,content:t.content},success:function(e){1==e.data.code&&(a.posts[a.index].commentList.push({postId:a.posts[a.index].id,content:t.content,commentUserId:a.myId,commentUserName:a.username}),a.init_input())},fail:function(t){e.showToast({title:t.data.message,position:"bottom"})}})},init_input:function(){this.showInput=!1,this.focus=!1,this.input_placeholder="评论",this.is_reply=!1},previewImage:function(t,n){for(var o=[],s=0,i=t.length;s<i;s++)o.push(t[s].url);var a=o[n];e.previewImage({current:a,urls:o})}}};t.default=p}).call(this,n("6e42")["default"],n("0de9")["default"])},"7f2c":function(e,t,n){"use strict";var o,s=function(){var e=this,t=e.$createElement,n=(e._self._c,e.__map(e.posts,function(t,n){var o=e.getCreateTime(n),s=e.isMine(t.publisherId);return{$orig:e.__get_orig(t),m0:o,m1:s}}));e.$mp.data=Object.assign({},{$root:{l0:n}})},i=[];n.d(t,"b",function(){return s}),n.d(t,"c",function(){return i}),n.d(t,"a",function(){return o})},"90b8":function(e,t,n){"use strict";n.r(t);var o=n("4cd5"),s=n.n(o);for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);t["default"]=s.a},bbcb:function(e,t,n){"use strict";var o=n("021a"),s=n.n(o);s.a},f5cc:function(e,t,n){"use strict";n.r(t);var o=n("7f2c"),s=n("90b8");for(var i in s)"default"!==i&&function(e){n.d(t,e,function(){return s[e]})}(i);n("bbcb");var a,r=n("f0c5"),c=Object(r["a"])(s["default"],o["b"],o["c"],!1,null,"33d614ee",null,!1,o["a"],a);t["default"]=c.exports}},[["3a4c","common/runtime","common/vendor"]]]);