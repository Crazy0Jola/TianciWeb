(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/tabbar/publish/publish"],{"026c":function(e,t,n){"use strict";n.r(t);var i=n("c585"),a=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,function(){return i[e]})}(r);t["default"]=a.a},"330e":function(e,t,n){"use strict";var i=n("e191"),a=n.n(i);a.a},"3da0":function(e,t,n){"use strict";(function(e){n("68ca"),n("921b");i(n("66fd"));var t=i(n("5aed"));function i(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("6e42")["createPage"])},"5aed":function(e,t,n){"use strict";n.r(t);var i=n("9635"),a=n("026c");for(var r in a)"default"!==r&&function(e){n.d(t,e,function(){return a[e]})}(r);n("330e");var s,o=n("f0c5"),u=Object(o["a"])(a["default"],i["b"],i["c"],!1,null,"a0bb6678",null,!1,i["a"],s);t["default"]=u.exports},9635:function(e,t,n){"use strict";var i,a=function(){var e=this,t=e.$createElement;e._self._c},r=[];n.d(t,"b",function(){return a}),n.d(t,"c",function(){return r}),n.d(t,"a",function(){return i})},c585:function(e,t,n){"use strict";(function(e,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=s(n("a34a")),r=s(n("56b9"));function s(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,i,a,r,s){try{var o=e[r](s),u=o.value}catch(c){return void n(c)}o.done?t(u):Promise.resolve(u).then(i,a)}function u(e){return function(){var t=this,n=arguments;return new Promise(function(i,a){var r=e.apply(t,n);function s(e){o(r,i,a,s,u,"next",e)}function u(e){o(r,i,a,s,u,"throw",e)}s(void 0)})}}var c=function(){return n.e("components/free-ui/free-nav-bar").then(n.bind(null,"c328"))},f=function(){return n.e("components/free-ui/free-confirm").then(n.bind(null,"ebf9"))},l=getApp().globalData.SERVER_API,p=e.getSystemInfoSync(),h=[["camera"],["album"],["camera","album"]],d=[["compressed"],["original"],["compressed","original"]],m={components:{freeNavBar:c,freeConfirm:f},data:function(){return{input_content:"",imageList:[],sourceTypeIndex:2,sourceType:["拍照","相册","拍照或相册"],sizeTypeIndex:2,sizeType:["压缩","原图","压缩或原图"],countIndex:8,count:[1,2,3,4,5,6,7,8,9]}},onUnload:function(){this.imageList=[],this.sourceTypeIndex=2,this.sourceType=["拍照","相册","拍照或相册"],this.sizeTypeIndex=2,this.sizeType=["压缩","原图","压缩或原图"],this.countIndex=8},methods:{compressImageHandler:function(){var e=u(a.default.mark(function e(t){var n;return a.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return console.log(i("platform==="+p.platform," at pages\\tabbar\\publish\\publish.vue:93")),e.next=3,(0,r.default)(t,p.platform);case 3:return n=e.sent,console.log(i("tempPath-----"+n," at pages\\tabbar\\publish\\publish.vue:95")),e.abrupt("return",n);case 6:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),publish:function(){var t=u(a.default.mark(function t(){var n,r,s,o,u=this;return a.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.input_content){t.next=3;break}return e.showToast({title:"内容不能为空",position:"bottom"}),t.abrupt("return");case 3:for(e.showLoading({title:"发布中"}),n=[],r=0,s=this.imageList.length;r<s;r++)o={name:"image"+(r+1),uri:this.imageList[r]},n.push(o);0==n.length?e.request({url:l+"appFriends/publish",data:{content:this.input_content},method:"POST",header:{token:e.getStorageSync("setUserData").token,"Content-Type":"application/x-www-form-urlencoded"},success:function(t){console.log(i(t," at pages\\tabbar\\publish\\publish.vue:128")),1==t.data.code&&(e.hideLoading(),e.$emit("publish"),u.$refs.confirm.show(function(t){var n=getCurrentPages(),i=n[n.length-2];e.navigateBack({success:function(){i.onLoad()}}),t()}))},fail:function(t){e.hideLoading(),e.showToast({title:"发布失败，请检查网络",icon:"none"})}}):e.uploadFile({url:l+"appFriends/publish",files:n,formData:{content:this.input_content},header:{token:e.getStorageSync("setUserData").token},success:function(t){var n=JSON.parse(t.data);1==n.code&&(e.hideLoading(),u.$refs.confirm.show(function(t){var n=getCurrentPages(),i=n[n.length-2];e.navigateBack({success:function(){i.onLoad()}}),t()}))},fail:function(t){e.hideLoading(),e.showToast({title:"发布失败，请检查网络",icon:"none"})}});case 7:case"end":return t.stop()}},t,this)}));function n(){return t.apply(this,arguments)}return n}(),getLocation:function(){return new Promise(function(t,n){e.getLocation({type:"wgs84",success:function(e){t(e)},fail:function(e){n(e)}})})},close:function(e){this.imageList.splice(e,1)},chooseImage:function(){var t=u(a.default.mark(function t(){var n,i=this;return a.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(9!==this.imageList.length){t.next=6;break}return t.next=3,this.isFullImg();case 3:if(n=t.sent,n){t.next=6;break}return t.abrupt("return");case 6:e.chooseImage({sourceType:h[this.sourceTypeIndex],sizeType:d[this.sizeTypeIndex],count:this.imageList.length+this.count[this.countIndex]>9?9-this.imageList.length:this.count[this.countIndex],success:function(){var e=u(a.default.mark(function e(t){var n,r,s,o,u;return a.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n=t.tempFilePaths,r=[],s=0;case 3:if(!(s<n.length)){e.next=12;break}return o=n[s],e.next=7,i.compressImageHandler(o);case 7:u=e.sent,r.push(u);case 9:s++,e.next=3;break;case 12:i.imageList=i.imageList.concat(r);case 13:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()});case 7:case"end":return t.stop()}},t,this)}));function n(){return t.apply(this,arguments)}return n}(),isFullImg:function(){var t=this;return new Promise(function(n){e.showModal({content:"已经有9张图片了,是否清空现有图片？",success:function(e){e.confirm?(t.imageList=[],n(!0)):n(!1)},fail:function(){n(!1)}})})},previewImage:function(t){var n=t.target.dataset.src;e.previewImage({current:n,urls:this.imageList})}}};t.default=m}).call(this,n("6e42")["default"],n("0de9")["default"])},e191:function(e,t,n){}},[["3da0","common/runtime","common/vendor"]]]);